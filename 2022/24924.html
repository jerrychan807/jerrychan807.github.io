<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jerrychan807.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Pre: Solidity by Example 学习记录基础语法的QuickView🧐🧐🧐 Hello World: pragma specifies the compiler version of Solidity. 12345678&#x2F;&#x2F; SPDX-License-Identifier: MIT&#x2F;&#x2F; compiler version must be greater than or equ">
<meta property="og:type" content="article">
<meta property="og:title" content="Doc-SolidityByExample_1_Basics">
<meta property="og:url" content="https://jerrychan807.github.io/2022/24924.html">
<meta property="og:site_name" content="Trash Bin">
<meta property="og:description" content="Pre: Solidity by Example 学习记录基础语法的QuickView🧐🧐🧐 Hello World: pragma specifies the compiler version of Solidity. 12345678&#x2F;&#x2F; SPDX-License-Identifier: MIT&#x2F;&#x2F; compiler version must be greater than or equ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220710095620.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220712105238.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220712113140.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713193040.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713194303.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713225842.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713225804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220714005053.png">
<meta property="article:published_time" content="2022-07-13T02:00:34.000Z">
<meta property="article:modified_time" content="2024-04-18T16:53:54.174Z">
<meta property="article:author" content="Foolisheddy">
<meta property="article:tag" content="SmartContract">
<meta property="article:tag" content="Document">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220710095620.png">

<link rel="canonical" href="https://jerrychan807.github.io/2022/24924.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Doc-SolidityByExample_1_Basics | Trash Bin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Trash Bin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jerrychan807.github.io/2022/24924.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2019/04/26/5cc1da1c90e1a.png">
      <meta itemprop="name" content="Foolisheddy">
      <meta itemprop="description" content="温故而知新">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Trash Bin">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Doc-SolidityByExample_1_Basics
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-13 10:00:34" itemprop="dateCreated datePublished" datetime="2022-07-13T10:00:34+08:00">2022-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-19 00:53:54" itemprop="dateModified" datetime="2024-04-19T00:53:54+08:00">2024-04-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Document/" itemprop="url" rel="index"><span itemprop="name">Document</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>52k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>48 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>Pre:</h1>
<p><a target="_blank" rel="noopener" href="https://web3dao-cn.github.io/solidity-example/">Solidity by Example</a> 学习记录基础语法的QuickView🧐🧐🧐</p>
<h1>Hello World:</h1>
<p><code>pragma</code> specifies the compiler version of Solidity.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line"><span class="comment">// compiler version must be greater than or equal to 0.8.10 and less than 0.9.0</span></span><br><span class="line"><span class="comment">// 规定编译器的版本范围</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">    string public greet = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就像python2或Python3，你最好声明出来，但<code>solidity</code>需要你强制声明，有规矩😅<br />
在线evm/在线运行环境支持多版本solidity，还挺好的，不像py2.x、py3.x还要自己运维server上的py版本。</p>
<h1>First App:</h1>
<p>Here is a simple contract that you can get, increment and decrement the count store in this contract.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Counter</span> &#123;</span><br><span class="line">    uint public count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to get the current count</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to increment count by 1</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">inc</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to decrement count by 1</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dec</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        count -= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Primitive Data Types:</h1>
<p>Here we introduce you to some primitive(基本) data types available in Solidity.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>boolean</p>
</li>
<li class="lvl-2">
<p>uint/int</p>
</li>
<li class="lvl-2">
<p>address</p>
</li>
</ul>
<p>基础知识:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bit = Binary digIT = 0 or 1</span><br><span class="line">Byte = a sequence of 8 bits = 00000000, 00000001, ..., or 11111111</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Primitives</span> &#123;</span><br><span class="line">    bool public boo = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    uint stands for unsigned integer, meaning non negative integers</span></span><br><span class="line"><span class="comment">    different sizes are available </span></span><br><span class="line"><span class="comment">        uint8   ranges from 0 to 2 ** 8 - 1</span></span><br><span class="line"><span class="comment">        uint16  ranges from 0 to 2 ** 16 - 1</span></span><br><span class="line"><span class="comment">        ...</span></span><br><span class="line"><span class="comment">        uint256 ranges from 0 to 2 ** 256 - 1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 无符号uint,无负数</span></span><br><span class="line">    <span class="comment">// uintX  X代表Bit 位，8bit= 1byte,uint256(32byte)默认就是一个Storage slot的长度</span></span><br><span class="line">    <span class="comment">// uint 是uint256的别名</span></span><br><span class="line">    </span><br><span class="line">    uint8 public u8 = <span class="number">1</span>;</span><br><span class="line">    uint public u256 = <span class="number">456</span>;</span><br><span class="line">    uint public u = <span class="number">123</span>; <span class="comment">// uint is an alias for uint256 u</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Negative numbers are allowed for int types.</span></span><br><span class="line"><span class="comment">    Like uint, different ranges are available from int8 to int256</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    int256 ranges from -2 ** 255 to 2 ** 255 - 1</span></span><br><span class="line"><span class="comment">    int128 ranges from -2 ** 127 to 2 ** 127 - 1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// int可代表负数</span></span><br><span class="line">    <span class="comment">// 可以定义的范围是：int8~int256，8为步长，也就是一个byte为步长</span></span><br><span class="line">    </span><br><span class="line">    int8 public i8 = -<span class="number">1</span>;</span><br><span class="line">    int public i256 = <span class="number">456</span>;</span><br><span class="line">    int public i = -<span class="number">123</span>; <span class="comment">// int is same as int256</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// minimum and maximum of int</span></span><br><span class="line">    int public minInt = <span class="title function_">type</span>(int).<span class="property">min</span>;</span><br><span class="line">    int public maxInt = <span class="title function_">type</span>(int).<span class="property">max</span>;</span><br><span class="line"></span><br><span class="line">    address public addr = <span class="number">0xCA35b7d915458EF540aDe6068dFe2F44E8fa733c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    In Solidity, the data type byte represent a sequence of bytes. </span></span><br><span class="line"><span class="comment">    Solidity presents two type of bytes types :</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     - fixed-sized byte arrays 固定长度字节数组 byteX</span></span><br><span class="line"><span class="comment">     - dynamically-sized byte arrays. 动态长度字节数组 bytes、byte[]</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     The term bytes in Solidity represents a dynamic array of bytes. </span></span><br><span class="line"><span class="comment">     It’s a shorthand for byte[] .</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    bytes1 a = <span class="number">0xb5</span>; <span class="comment">//  [10110101]</span></span><br><span class="line">    bytes1 b = <span class="number">0x56</span>; <span class="comment">//  [01010110]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只声明，未赋值的变量都有默认值</span></span><br><span class="line">    <span class="comment">// Default values</span></span><br><span class="line">    <span class="comment">// Unassigned variables have a default value</span></span><br><span class="line">    bool public defaultBoo; <span class="comment">// false</span></span><br><span class="line">    uint public defaultUint; <span class="comment">// 0</span></span><br><span class="line">    int public defaultInt; <span class="comment">// 0</span></span><br><span class="line">    address public defaultAddr; <span class="comment">// 0x0000000000000000000000000000000000000000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在EVM中，32是一个重要的数字，要记住！<img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220710095620.png" alt="20220710095620" /><br />
每个存储槽Storage slot可以存32byte的数据</p>
<p><img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220712105238.png" alt="20220712105238" /></p>
<p>整数值、布尔值、地址值这些固定长度的基本类型，在定义长度的时候都和32byte 息息相关。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>整数范围 uint8(Bit)<sub>uint256(Bit):最小1byte</sub>最大32byte</p>
</li>
<li class="lvl-2">
<p>uint = uint256:32byte</p>
</li>
</ul>
<p>地址值蛮特别，别的编程语言里没有。</p>
<h1>Variables</h1>
<p>There are 3 types of variables in Solidity<br />
从作用域、存储位置去区分</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>local 局部变量</p>
</li>
<li class="lvl-3">
<p>declared inside a function</p>
</li>
<li class="lvl-3">
<p>not stored on the blockchain</p>
</li>
<li class="lvl-2">
<p>state 状态变量</p>
</li>
<li class="lvl-3">
<p>declared outside a function</p>
</li>
<li class="lvl-3">
<p>stored on the blockchain</p>
</li>
<li class="lvl-2">
<p>global (provides information about the blockchain) 全局变量</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Variables</span> &#123;</span><br><span class="line">    <span class="comment">// State variables are stored on the blockchain.</span></span><br><span class="line">    string public text = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    uint public num = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// Local variables are not saved to the blockchain.</span></span><br><span class="line">        uint i = <span class="number">456</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Here are some global variables</span></span><br><span class="line">        uint timestamp = block.<span class="property">timestamp</span>; <span class="comment">// Current block timestamp</span></span><br><span class="line">        address sender = msg.<span class="property">sender</span>; <span class="comment">// address of the caller</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>State Variable</code>声明的位置有点像py里的全局变量/class变量，但特点在于它是存储在blockchain上的，一旦存储在blockchain,那全世界都可以访问了，应该叫<code>World State Variable</code>😂</p>
<h1>Constants</h1>
<p>Constants are variables that cannot be modified.<br />
Their value is hard coded and using constants can save gas cost.</p>
<p>不可修改、省gas</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="comment">// 格式约定：对常量大写</span></span><br><span class="line">    <span class="comment">// coding convention to uppercase constant variables</span></span><br><span class="line">    address public constant <span class="variable constant_">MY_ADDRESS</span> = <span class="number">0x777788889999AaAAbBbbCcccddDdeeeEfFFfCcCc</span>;</span><br><span class="line">    uint public constant <span class="variable constant_">MY_UINT</span> = <span class="number">123</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常量/不可变量似乎跟别的编程语言没有啥区别，但考虑到存储位置的不同：别的编程语言一个常量可能就存储在单机server上，但由于是状态变量存在world State/blockchain上的，分布式存储的，存储消耗是要算一个乘法的，就要好好计价了(gas敏感)，能省则省。</p>
<h1>Immutable</h1>
<p>Immutable variables are like constants. Values of immutable variables can be set inside the constructor but cannot be modified afterwards.<br />
跟<code>constant</code>的区别在于赋值的位置不一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Immutable</span> &#123;</span><br><span class="line">    <span class="comment">// 格式约定：对常量大写</span></span><br><span class="line">    <span class="comment">// coding convention to uppercase constant variables</span></span><br><span class="line">    address public immutable <span class="variable constant_">MY_ADDRESS</span>;</span><br><span class="line">    uint public immutable <span class="variable constant_">MY_UINT</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">uint _myUint</span>) &#123;</span><br><span class="line">        <span class="variable constant_">MY_ADDRESS</span> = msg.<span class="property">sender</span>;</span><br><span class="line">        <span class="variable constant_">MY_UINT</span> = _myUint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Reading and Writing to a State Variable</h1>
<p>To write or update a state variable you need to send a <code>transaction</code>.<br />
On the other hand, you can read state variables, for free, without any transaction fee.</p>
<p>对状态变量的读写，读免费， 写/改变其状态的话，要发交易/要耗gas。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">SimpleStorage</span> &#123;</span><br><span class="line">    <span class="comment">// State variable to store a number</span></span><br><span class="line">    uint public num;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You need to send a transaction to write to a state variable.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">uint _num</span>) public &#123;</span><br><span class="line">        num = _num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You can read from a state variable without sending a transaction.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样要考虑到blockchain分布式多节点的问题，表面看似只改一个状态变量的值，但改了世界各地节点的存储。</p>
<h1>Ether and Wei</h1>
<p>Transactions are paid with ether. 交易以ether单位计价<br />
Similar to how one dollar is equal to 100 cent, one ether is equal to 1018 wei.<br />
1美元=100美分，1Ether=1e18Wei，solidity自定义了自己的单位</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">EtherUnits</span> &#123;</span><br><span class="line">    uint public oneWei = <span class="number">1</span> wei;</span><br><span class="line">    <span class="comment">// 1 wei is equal to 1</span></span><br><span class="line">    bool public isOneWei = <span class="number">1</span> wei == <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    uint public oneEther = <span class="number">1</span> ether;</span><br><span class="line">    <span class="comment">// 1 ether is equal to 10^18 wei</span></span><br><span class="line">    bool public isOneEther = <span class="number">1</span> ether == <span class="number">1e18</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Gas and Gas Price：</h1>
<p>How much <code>ether</code> do you need to pay for a transaction?<br />
You pay <code>gas spent * gas price</code>(数量*愿意出的单价) amount of <code>ether</code>, where</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>gas</code> is a <strong>unit</strong> of computation 计算单位</p>
</li>
<li class="lvl-2">
<p><code>gas spent</code> is the <strong>total amount</strong> of gas used in a transaction</p>
</li>
<li class="lvl-2">
<p><code>gas price</code> is how much ether you are willing to pay per gas</p>
</li>
</ul>
<p>|  keyword | 含义 |<br />
| — | — |— |<br />
| gas | 计价单位 |<br />
| gas spent | 交易里花费了多少份gas |   |<br />
| gas price | gas的单价 |   |</p>
<p>Transactions with higher gas price have higher priority to be included in a block.<br />
Unspent gas will be refunded.</p>
<p>有点像在拍卖东西，你愿意出的拍卖价(筹码数量 x 筹码价格)</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>A: 筹码数量10 x 筹码价格10=100</p>
</li>
<li class="lvl-2">
<p>B: 筹码数量10 x 筹码价格20=200</p>
</li>
<li class="lvl-2">
<p>C: 筹码数量20 x 筹码价格10=200</p>
</li>
</ul>
<p>然后价高者得，优先处理你的交易。拍卖价的计算公式：<code>gas spent * gas price</code> ，为了加快交易，你可以提高筹码数量或每个筹码的价格，最终拍卖价变高就行。</p>
<blockquote>
<p>以太坊经常被描述为“世界计算机”，以太坊是一个开源的，全球分散的计算基础设施，执行称为智能合约的程序。它使用区块链来同步和存储系统的状态变化，以及称为<strong>以太网的加密货币来计量和约束执行资源成本。</strong>——《mastering-ethereum》</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220712113140.png" alt="20220712113140" /></p>
<h2 id="Gas-Limit">Gas Limit</h2>
<p>There are 2 upper bounds to the amount of gas you can spend</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>gas limit</code> (max amount of gas you’re willing to use for your transaction, set by you)</p>
</li>
<li class="lvl-2">
<p><code>block gas limit</code> (max amount of gas allowed in a block, set by the network)</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Gas</span> &#123;</span><br><span class="line">    uint public i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using up all of the gas that you send causes your transaction to fail.</span></span><br><span class="line">    <span class="comment">// State changes are undone.</span></span><br><span class="line">    <span class="comment">// Gas spent are not refunded.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">forever</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// Here we run a loop until all of the gas are spent</span></span><br><span class="line">        <span class="comment">// and the transaction fails</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>If / Else:</h1>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">IfElse</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">uint x</span>) public pure returns (uint) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ternary</span>(<span class="params">uint _x</span>) public pure returns (uint) &#123;</span><br><span class="line">        <span class="comment">// if (_x &lt; 10) &#123;</span></span><br><span class="line">        <span class="comment">//     return 1;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// return 2;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// shorthand way to write if / else statement</span></span><br><span class="line">        <span class="keyword">return</span> _x &lt; <span class="number">10</span> ? <span class="number">1</span> : <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>For and While Loop:</h1>
<p>Solidity supports for, while, and do while loops.<br />
Don’t write loops that are unbounded as this can hit the gas limit, causing your transaction to fail.<br />
For the reason above, while and do while loops are rarely used.</p>
<p>很少用<code>while</code>和<code>do while</code>每个opcode都有其gas定价，过多循环，只会累加gas，很可能达到block的gas limit导致交易失败。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Loop</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// for loop</span></span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">// Skip to next iteration with continue</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="comment">// Exit loop with break</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// while loop</span></span><br><span class="line">        uint j;</span><br><span class="line">        <span class="keyword">while</span> (j &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Mapping</h1>
<p>Maps are created with the syntax mapping(keyType =&gt; valueType).<br />
<strong>The keyType can be any built-in value type</strong>, bytes, string, or any contract.</p>
<blockquote>
<p>TODO:哪些是类型可以做Key？常用用什么做key?</p>
</blockquote>
<p>valueType can be any type including another mapping or an array.<br />
Mappings are not iterable.</p>
<p>Array Vs 哈希表：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Array:没有目录的字典</p>
</li>
<li class="lvl-2">
<p>哈希表:有目录的字典</p>
</li>
</ul>
<p>在数组中如果要找一个单词，由于不知道我们在哪个位置，所以只能从头开始查询（又称线性查找），数据量越大越难查。想想不用手写字母作为索引，直接去字典里翻找字典多麻烦。。。在哈希表中，有Key作为标识符，按图索骥,找东西就快很多。在数据存储上的灵活性和数据查询上的高效性,适合用来存用于余额等数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Mapping</span> &#123;</span><br><span class="line">    <span class="comment">// Mapping from address to uint</span></span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint) public myMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">address _addr</span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="comment">// Mapping always returns a value.</span></span><br><span class="line">        <span class="comment">// If the value was never set, it will return the default value.</span></span><br><span class="line">        <span class="keyword">return</span> myMap[_addr];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">address _addr, uint _i</span>) public &#123;</span><br><span class="line">        <span class="comment">// Update the value at this address</span></span><br><span class="line">        myMap[_addr] = _i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">address _addr</span>) public &#123;</span><br><span class="line">        <span class="comment">// Reset the value to the default value.</span></span><br><span class="line">        <span class="keyword">delete</span> myMap[_addr];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">NestedMapping</span> &#123;</span><br><span class="line">    <span class="comment">// Nested mapping (mapping from address to another mapping)</span></span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> <span class="title function_">mapping</span>(<span class="function"><span class="params">uint</span> =&gt;</span> bool)) public nested;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">address _addr1, uint _i</span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="comment">// You can get values from a nested mapping</span></span><br><span class="line">        <span class="comment">// even when it is not initialized</span></span><br><span class="line">        <span class="keyword">return</span> nested[_addr1][_i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address _addr1,</span></span><br><span class="line"><span class="params">        uint _i,</span></span><br><span class="line"><span class="params">        bool _boo</span></span><br><span class="line"><span class="params">    </span>) public &#123;</span><br><span class="line">        nested[_addr1][_i] = _boo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">address _addr1, uint _i</span>) public &#123;</span><br><span class="line">        <span class="keyword">delete</span> nested[_addr1][_i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Array：</h1>
<p>Array can have a compile-time fixed size or a dynamic size.<br />
固定长度或动态长度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Array</span> &#123;</span><br><span class="line">    <span class="comment">// Several ways to initialize an array</span></span><br><span class="line">    <span class="comment">// 多种方式初始化</span></span><br><span class="line">    uint[] public arr;</span><br><span class="line">    uint[] public arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="comment">// Fixed sized array, all elements initialize to 0</span></span><br><span class="line">    uint[<span class="number">10</span>] public myFixedSizeArr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">uint i</span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr[i]; <span class="comment">// 通过下标去找</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Solidity can return the entire array. 能返回整个数组，但避免能无限长的数组。</span></span><br><span class="line">    <span class="comment">// But this function should be avoided for</span></span><br><span class="line">    <span class="comment">// arrays that can grow indefinitely in length.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getArr</span>(<span class="params"></span>) public view returns (uint[] memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">push</span>(<span class="params">uint i</span>) public &#123;</span><br><span class="line">        <span class="comment">// Append to array</span></span><br><span class="line">        <span class="comment">// This will increase the array length by 1. // 长度+1</span></span><br><span class="line">        arr.<span class="title function_">push</span>(i); <span class="comment">// 在尾端加入，追加</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">pop</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// Remove last element from array</span></span><br><span class="line">        <span class="comment">// This will decrease the array length by 1 // 长度-1</span></span><br><span class="line">        arr.<span class="title function_">pop</span>(); <span class="comment">// 在尾端去除</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params"></span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr.<span class="property">length</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">uint index</span>) public &#123;</span><br><span class="line">        <span class="comment">// Delete does not change the array length. 不改变数组长度，仅设为默认值</span></span><br><span class="line">        <span class="comment">// It resets the value at index to it&#x27;s default value,</span></span><br><span class="line">        <span class="comment">// in this case 0</span></span><br><span class="line">        <span class="keyword">delete</span> arr[index]; <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">examples</span>(<span class="params"></span>) external &#123;</span><br><span class="line">        <span class="comment">// create array in memory, only fixed size can be created</span></span><br><span class="line">        uint[] memory a = <span class="keyword">new</span> uint[](<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Examples of removing array element</p>
<h2 id="Remove-array-element-by-shifting-elements-from-right-to-left">Remove array element by shifting elements from right to left</h2>
<p>自带的<code>delete arr[index];</code>不改变数组长度，仅把要删除的位置的 值 设为默认值，会有“脏数据”。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"><span class="comment">// 在要删除索引的位置，之后的值依次向前覆盖,再pop掉最后一个元素</span></span><br><span class="line">contract <span class="title class_">ArrayRemoveByShifting</span> &#123;</span><br><span class="line">    <span class="comment">// [1, 2, 3] -- remove(1) --&gt; [1, 3, 3] --&gt; [1, 3]</span></span><br><span class="line">    <span class="comment">// [1, 2, 3, 4, 5, 6] -- remove(2) --&gt; [1, 2, 4, 5, 6, 6] --&gt; [1, 2, 4, 5, 6]</span></span><br><span class="line">    <span class="comment">// [1, 2, 3, 4, 5, 6] -- remove(0) --&gt; [2, 3, 4, 5, 6, 6] --&gt; [2, 3, 4, 5, 6]</span></span><br><span class="line">    <span class="comment">// [1] -- remove(0) --&gt; [1] --&gt; []</span></span><br><span class="line"></span><br><span class="line">    uint[] public arr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">uint _index</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(_index &lt; arr.<span class="property">length</span>, <span class="string">&quot;index out of bound&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (uint i = _index; i &lt; arr.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            arr[i] = arr[i + <span class="number">1</span>]; <span class="comment">// 在要删除索引的位置，之后的值依次向前覆盖</span></span><br><span class="line">        &#125;</span><br><span class="line">        arr.<span class="title function_">pop</span>();<span class="comment">// </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) external &#123;</span><br><span class="line">        arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">        <span class="title function_">remove</span>(<span class="number">2</span>); <span class="comment">// 删除值为3的元素</span></span><br><span class="line">        <span class="comment">// [1, 2, 4, 5]</span></span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">0</span>] == <span class="number">1</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">1</span>] == <span class="number">2</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">2</span>] == <span class="number">4</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">3</span>] == <span class="number">5</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr.<span class="property">length</span> == <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        arr = [<span class="number">1</span>];</span><br><span class="line">        <span class="title function_">remove</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// []</span></span><br><span class="line">        <span class="title function_">assert</span>(arr.<span class="property">length</span> == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Remove-array-element-by-copying-last-element-into-to-the-place-to-remove">Remove array element by copying last element into to the place to remove</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"><span class="comment">// 用最后一个元素 覆盖 要函数的元素</span></span><br><span class="line">contract <span class="title class_">ArrayReplaceFromEnd</span> &#123;</span><br><span class="line">    uint[] public arr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Deleting an element creates a gap in the array.</span></span><br><span class="line">    <span class="comment">// One trick to keep the array compact is to</span></span><br><span class="line">    <span class="comment">// move the last element into the place to delete.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">uint index</span>) public &#123;</span><br><span class="line">        <span class="comment">// Move the last element into the place to delete</span></span><br><span class="line">        arr[index] = arr[arr.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// Remove the last element</span></span><br><span class="line">        arr.<span class="title function_">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        <span class="title function_">remove</span>(<span class="number">1</span>); <span class="comment">// 删除值为2的元素</span></span><br><span class="line">        <span class="comment">// [1, 4, 3]</span></span><br><span class="line">        <span class="title function_">assert</span>(arr.<span class="property">length</span> == <span class="number">3</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">0</span>] == <span class="number">1</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">1</span>] == <span class="number">4</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">2</span>] == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">remove</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// [1, 4]</span></span><br><span class="line">        <span class="title function_">assert</span>(arr.<span class="property">length</span> == <span class="number">2</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">0</span>] == <span class="number">1</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">1</span>] == <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Enum:</h1>
<p>Solidity supports enumerables and they are useful to model choice and keep track of state.<br />
单选项，适合来表示状态,主要用于为<code>uint</code>分配名称，使程序易于阅读和维护<br />
Enums can be declared outside of a contract.枚举类型可以在合约外定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Enum</span> &#123;</span><br><span class="line">    <span class="comment">// Enum representing shipping status</span></span><br><span class="line">    enum <span class="title class_">Status</span> &#123;</span><br><span class="line">        <span class="title class_">Pending</span>,</span><br><span class="line">        <span class="title class_">Shipped</span>,</span><br><span class="line">        <span class="title class_">Accepted</span>,</span><br><span class="line">        <span class="title class_">Rejected</span>,</span><br><span class="line">        <span class="title class_">Canceled</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default value is the first element listed in</span></span><br><span class="line">    <span class="comment">// definition of the type, in this case &quot;Pending&quot;</span></span><br><span class="line">    <span class="title class_">Status</span> public status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns uint</span></span><br><span class="line">    <span class="comment">// Pending  - 0</span></span><br><span class="line">    <span class="comment">// Shipped  - 1</span></span><br><span class="line">    <span class="comment">// Accepted - 2</span></span><br><span class="line">    <span class="comment">// Rejected - 3</span></span><br><span class="line">    <span class="comment">// Canceled - 4</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params"></span>) public view returns (<span class="title class_">Status</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update status by passing uint into input</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">Status _status</span>) public &#123;</span><br><span class="line">        status = _status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You can update to a specific enum like this</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">cancel</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        status = <span class="title class_">Status</span>.<span class="property">Canceled</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete resets the enum to its first value, 0</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">reset</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="keyword">delete</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713193040.png" alt="20220713193040" /><br />
设置和获取的都是无符号整数型</p>
<h2 id="合约外定义：">合约外定义：</h2>
<p>Declaring and importing Enum File that the enum is declared in</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"><span class="comment">// This is saved &#x27;EnumDeclaration.sol&#x27;</span></span><br><span class="line"></span><br><span class="line">enum <span class="title class_">Status</span> &#123;</span><br><span class="line">    <span class="title class_">Pending</span>,</span><br><span class="line">    <span class="title class_">Shipped</span>,</span><br><span class="line">    <span class="title class_">Accepted</span>,</span><br><span class="line">    <span class="title class_">Rejected</span>,</span><br><span class="line">    <span class="title class_">Canceled</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">File</span> that imports the enum above</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./EnumDeclaration.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Enum</span> &#123;</span><br><span class="line">    <span class="title class_">Status</span> public status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Structs:</h1>
<p>You can define your own type by creating a struct.自定义类型,形式上与<code>enum</code>相似，但可以比enum定义更多的类型<br />
They are useful for grouping together related data. 组织数据<br />
Structs can be declared outside of a contract and imported in another contract.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Todos</span> &#123;</span><br><span class="line">    struct <span class="title class_">Todo</span> &#123;</span><br><span class="line">        string text;</span><br><span class="line">        bool completed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// An array of &#x27;Todo&#x27; structs</span></span><br><span class="line">    <span class="title class_">Todo</span>[] public todos;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">string memory _text</span>) public &#123;</span><br><span class="line">        <span class="comment">// 3 ways to initialize a struct</span></span><br><span class="line">        <span class="comment">// - calling it like a function</span></span><br><span class="line">        todos.<span class="title function_">push</span>(<span class="title class_">Todo</span>(_text, <span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key value mapping</span></span><br><span class="line">        todos.<span class="title function_">push</span>(<span class="title class_">Todo</span>(&#123;<span class="attr">text</span>: _text, <span class="attr">completed</span>: <span class="literal">false</span>&#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialize an empty struct and then update it</span></span><br><span class="line">        <span class="title class_">Todo</span> memory todo;</span><br><span class="line">        todo.<span class="property">text</span> = _text;</span><br><span class="line">        <span class="comment">// todo.completed initialized to false</span></span><br><span class="line"></span><br><span class="line">        todos.<span class="title function_">push</span>(todo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Solidity automatically created a getter for &#x27;todos&#x27; so</span></span><br><span class="line">    <span class="comment">// you don&#x27;t actually need this function.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">uint _index</span>) public view returns (string memory text, bool completed) &#123;</span><br><span class="line">        <span class="title class_">Todo</span> storage todo = todos[_index];</span><br><span class="line">        <span class="keyword">return</span> (todo.<span class="property">text</span>, todo.<span class="property">completed</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update text</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">uint _index, string memory _text</span>) public &#123;</span><br><span class="line">        <span class="title class_">Todo</span> storage todo = todos[_index];</span><br><span class="line">        todo.<span class="property">text</span> = _text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update completed</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toggleCompleted</span>(<span class="params">uint _index</span>) public &#123;</span><br><span class="line">        <span class="title class_">Todo</span> storage todo = todos[_index];</span><br><span class="line">        todo.<span class="property">completed</span> = !todo.<span class="property">completed</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713194303.png" alt="20220713194303" /><br />
用index取值</p>
<h2 id="导入struct：">导入struct：</h2>
<p>Declaring and importing Struct File that the struct is declared in</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">struct <span class="title class_">Todo</span> &#123;</span><br><span class="line">    string text;</span><br><span class="line">    bool completed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>File that imports the struct above</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./StructDeclaration.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Todos</span> &#123;</span><br><span class="line">    <span class="comment">// An array of &#x27;Todo&#x27; structs</span></span><br><span class="line">    <span class="title class_">Todo</span>[] public todos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Data Locations - Storage, Memory and Calldata:</h1>
<p>Variables are declared as either <code>storage</code>, <code>memory</code> or <code>calldata</code> to explicitly specify the location of the data.<br />
定义数据存储的位置</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>storage</code> - variable is a state variable (store on blockchain) World State变量😆，存在链上</p>
</li>
<li class="lvl-2">
<p><code>memory</code> - variable is in memory and it exists while a function is being called 函数里的临时变量</p>
</li>
<li class="lvl-2">
<p><code>calldata</code> - special data location that contains function arguments 用于函数参数</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">DataLocations</span> &#123;</span><br><span class="line">    uint[] public arr;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">uint</span> =&gt;</span> address) map;</span><br><span class="line">    struct <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">        uint foo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">uint</span> =&gt;</span> <span class="title class_">MyStruct</span>) myStructs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// call _f with state variables</span></span><br><span class="line">        <span class="title function_">_f</span>(arr, map, myStructs[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get a struct from a mapping</span></span><br><span class="line">        <span class="comment">// &#123;Type&#125; &#123;Location&#125; &#123;VariableName&#125; 😤😤😤</span></span><br><span class="line">        <span class="title class_">MyStruct</span> storage myStruct = myStructs[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// create a struct in memory</span></span><br><span class="line">        <span class="title class_">MyStruct</span> memory myMemStruct = <span class="title class_">MyStruct</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_f</span>(<span class="params"></span></span><br><span class="line"><span class="params">        uint[] storage _arr,</span></span><br><span class="line"><span class="params">        mapping(uint =&gt; address) storage _map,</span></span><br><span class="line"><span class="params">        MyStruct storage _myStruct</span></span><br><span class="line"><span class="params">    </span>) internal &#123;</span><br><span class="line">        <span class="comment">// do something with storage variables</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You can return memory variables</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">g</span>(<span class="params">uint[] memory _arr</span>) public returns (uint[] memory) &#123;</span><br><span class="line">        <span class="comment">// do something with memory array</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">uint[] calldata _arr</span>) external &#123;</span><br><span class="line">        <span class="comment">// do something with calldata array</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没有解释得很清楚😕 ，需要例子不是很清楚什么时候用<code>calldata</code></p>
<h1>Function:</h1>
<p>There are several ways to return outputs from a function.  return的多种情况<br />
Public functions cannot accept certain data types as inputs or outputs</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Function</span> &#123;</span><br><span class="line">    <span class="comment">// Functions can return multiple values. </span></span><br><span class="line">    <span class="comment">// 一次能返回多个数据</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">returnMany</span>(<span class="params"></span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            uint,</span><br><span class="line">            bool,</span><br><span class="line">            uint</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>, <span class="literal">true</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return values can be named. </span></span><br><span class="line">    <span class="comment">// 返回值可以命名</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">named</span>(<span class="params"></span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            uint x,</span><br><span class="line">            bool b,</span><br><span class="line">            uint y</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>, <span class="literal">true</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return values can be assigned to their name.</span></span><br><span class="line">    <span class="comment">// In this case the return statement can be omitted. </span></span><br><span class="line">    <span class="comment">// 提前声明返回值，可省略返回语句，隐式返回</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">assigned</span>(<span class="params"></span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            uint x,</span><br><span class="line">            bool b,</span><br><span class="line">            uint y</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        b = <span class="literal">true</span>;</span><br><span class="line">        y = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use destructuring assignment when calling another</span></span><br><span class="line">    <span class="comment">// function that returns multiple values.</span></span><br><span class="line">    <span class="comment">// 非结构化赋值</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">destructuringAssignments</span>(<span class="params"></span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            uint,</span><br><span class="line">            bool,</span><br><span class="line">            uint,</span><br><span class="line">            uint,</span><br><span class="line">            uint</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        (uint i, bool b, uint j) = <span class="title function_">returnMany</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Values can be left out.  </span></span><br><span class="line">        <span class="comment">// 非结构化赋值</span></span><br><span class="line">        <span class="comment">// 空开</span></span><br><span class="line">        (uint x, , uint y) = (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (i, b, j, x, y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cannot use map for either input or output</span></span><br><span class="line">    <span class="comment">// map不能作为输入或输出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can use array for input</span></span><br><span class="line">    <span class="comment">// 数组可作为输入</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">arrayInput</span>(<span class="params">uint[] memory _arr</span>) public &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can use array for output</span></span><br><span class="line">    <span class="comment">// 数组可作为输出</span></span><br><span class="line">    uint[] public arr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">arrayOutput</span>(<span class="params"></span>) public view returns (uint[] memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>View and Pure Functions:</h1>
<p><code>Getter</code> functions can be declared <code>view</code> or <code>pure</code>.<br />
<code>View</code> function declares that no state will be changed. 没有world State变量会改变<br />
<code>Pure</code> function declares that no state variable will be changed or read. 没有world State变量会改变或读取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">ViewAndPure</span> &#123;</span><br><span class="line">    uint public x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Promise not to modify the state.</span></span><br><span class="line">    <span class="comment">// 保证不改变状态变量，就是不改Storage的东西</span></span><br><span class="line">    <span class="comment">// 视图函数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addToX</span>(<span class="params">uint y</span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Promise not to modify or read from the state.</span></span><br><span class="line">    <span class="comment">// 读都不读，纯纯的函数了</span></span><br><span class="line">    <span class="comment">// 纯函数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">uint i, uint j</span>) public pure returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Error:</h1>
<p>An error will undo all changes made to the state during a transaction.<br />
You can throw an error by calling <code>require</code>, <code>revert</code> or <code>assert</code>.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>require</code> is used to validate inputs and conditions before execution. 在执行代码前，验证输入</p>
</li>
<li class="lvl-2">
<p><code>revert</code> is similar to <code>require</code>. See the code below for details.</p>
</li>
<li class="lvl-2">
<p><code>assert</code> is used to check for code that should never be false. Failing assertion probably means that there is a bug.<br />
Use custom error to save gas.</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Error</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testRequire</span>(<span class="params">uint _i</span>) public pure &#123;</span><br><span class="line">        <span class="comment">// Require should be used to validate conditions such as:</span></span><br><span class="line">        <span class="comment">// - inputs</span></span><br><span class="line">        <span class="comment">// - conditions before execution</span></span><br><span class="line">        <span class="comment">// - return values from calls to other functions</span></span><br><span class="line">        <span class="comment">// 三种情况：外部输入、执行前的一些判断条件、其它函数的返回值</span></span><br><span class="line">        <span class="built_in">require</span>(_i &gt; <span class="number">10</span>, <span class="string">&quot;Input must be greater than 10&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testRevert</span>(<span class="params">uint _i</span>) public pure &#123;</span><br><span class="line">        <span class="comment">// Revert is useful when the condition to check is complex.</span></span><br><span class="line">        <span class="comment">// This code does the exact same thing as the example above</span></span><br><span class="line">        <span class="comment">// 复杂的检验条件</span></span><br><span class="line">        <span class="comment">// 与上面的代码相同</span></span><br><span class="line">        <span class="keyword">if</span> (_i &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="title function_">revert</span>(<span class="string">&quot;Input must be greater than 10&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uint public num;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testAssert</span>(<span class="params"></span>) public view &#123;</span><br><span class="line">        <span class="comment">// Assert should only be used to test for internal errors,</span></span><br><span class="line">        <span class="comment">// and to check invariants.</span></span><br><span class="line">        <span class="comment">// 仅用于内部错误检查 或 去检查一些不变量</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Here we assert that num is always equal to 0</span></span><br><span class="line">        <span class="comment">// since it is impossible to update the value of num</span></span><br><span class="line">        <span class="title function_">assert</span>(num == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// custom error</span></span><br><span class="line">    error <span class="title class_">InsufficientBalance</span>(uint balance, uint withdrawAmount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testCustomError</span>(<span class="params">uint _withdrawAmount</span>) public view &#123;</span><br><span class="line">        uint bal = <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>;</span><br><span class="line">        <span class="keyword">if</span> (bal &lt; _withdrawAmount) &#123;</span><br><span class="line">            revert <span class="title class_">InsufficientBalance</span>(&#123;<span class="attr">balance</span>: bal, <span class="attr">withdrawAmount</span>: _withdrawAmount&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is another example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Account</span> &#123;</span><br><span class="line">    uint public balance;</span><br><span class="line">    uint public constant <span class="variable constant_">MAX_UINT</span> = <span class="number">2</span>**<span class="number">256</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">deposit</span>(<span class="params">uint _amount</span>) public &#123;</span><br><span class="line">        uint oldBalance = balance;</span><br><span class="line">        uint newBalance = balance + _amount;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// balance + _amount does not overflow if balance + _amount &gt;= balance</span></span><br><span class="line">        <span class="built_in">require</span>(newBalance &gt;= oldBalance, <span class="string">&quot;Overflow&quot;</span>); <span class="comment">// 检查外部输入</span></span><br><span class="line"></span><br><span class="line">        balance = newBalance;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assert</span>(balance &gt;= oldBalance); <span class="comment">// 检查内部错误</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params">uint _amount</span>) public &#123;</span><br><span class="line">        uint oldBalance = balance;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// balance - _amount does not underflow if balance &gt;= _amount</span></span><br><span class="line">        <span class="built_in">require</span>(balance &gt;= _amount, <span class="string">&quot;Underflow&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (balance &lt; _amount) &#123;</span><br><span class="line">            <span class="title function_">revert</span>(<span class="string">&quot;Underflow&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        balance -= _amount;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assert</span>(balance &lt;= oldBalance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Function Modifier:</h1>
<p>Modifiers are code that can be run before and / or <strong>after a function call</strong>.🤔🤔🤔</p>
<p>Modifiers can be used to:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Restrict access</p>
</li>
<li class="lvl-2">
<p>Validate inputs</p>
</li>
<li class="lvl-2">
<p>Guard against reentrancy hack</p>
</li>
</ul>
<p>类似python的修饰器，其实本质是一个函数，可以定义任何功能的修饰器。一般修饰器的功能用于做 pre_check，相当于把<code>require</code>的代码块抽离出去了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">FunctionModifier</span> &#123;</span><br><span class="line">    <span class="comment">// We will use these variables to demonstrate how to use</span></span><br><span class="line">    <span class="comment">// modifiers.</span></span><br><span class="line">    address public owner;</span><br><span class="line">    uint public x = <span class="number">10</span>;</span><br><span class="line">    bool public locked;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// Set the transaction sender as the owner of the contract.</span></span><br><span class="line">        owner = msg.<span class="property">sender</span>; <span class="comment">// 创建合约//发起一个创建合约的交易/创建人是 owner</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Modifier to check that the caller is the owner of</span></span><br><span class="line">    <span class="comment">// the contract.</span></span><br><span class="line">    modifier <span class="title function_">onlyOwner</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner, <span class="string">&quot;Not owner&quot;</span>);</span><br><span class="line">        <span class="comment">// Underscore is a special character only used inside</span></span><br><span class="line">        <span class="comment">// a function modifier and it tells Solidity to</span></span><br><span class="line">        <span class="comment">// execute the rest of the code.</span></span><br><span class="line">        <span class="comment">// 下划线，类似预留位置😆</span></span><br><span class="line">        _; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Modifiers can take inputs. This modifier checks that the</span></span><br><span class="line">    <span class="comment">// address passed in is not the zero address.</span></span><br><span class="line">    <span class="comment">// 检测入参地址 非0</span></span><br><span class="line">    modifier <span class="title function_">validAddress</span>(<span class="params">address _addr</span>) &#123;</span><br><span class="line">        <span class="built_in">require</span>(_addr != <span class="title function_">address</span>(<span class="number">0</span>), <span class="string">&quot;Not valid address&quot;</span>);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">changeOwner</span>(<span class="params">address _newOwner</span>) public onlyOwner <span class="title function_">validAddress</span>(<span class="params">_newOwner</span>) &#123;</span><br><span class="line">        owner = _newOwner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Modifiers can be called before and / or after a function.</span></span><br><span class="line">    <span class="comment">// This modifier prevents a function from being called while</span></span><br><span class="line">    <span class="comment">// it is still executing.</span></span><br><span class="line">    <span class="comment">// 防重入修饰器：当函数在执行时不能被调用</span></span><br><span class="line">    modifier <span class="title function_">noReentrancy</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">require</span>(!locked, <span class="string">&quot;No reentrancy&quot;</span>);</span><br><span class="line"></span><br><span class="line">        locked = <span class="literal">true</span>;</span><br><span class="line">        _;</span><br><span class="line">        locked = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">decrement</span>(<span class="params">uint i</span>) public noReentrancy &#123;</span><br><span class="line">        x -= i;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">decrement</span>(i - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Events:</h1>
<p><code>Events</code> allow logging to the Ethereum blockchain. Some use cases for events are:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Listening for events and updating user interface 可用作通知，前端可以监听并更新用户界面</p>
</li>
<li class="lvl-2">
<p>A cheap form of storage  非必要存储的，不记录在storage里，记录在event里</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Event</span> &#123;</span><br><span class="line">    <span class="comment">// Event declaration</span></span><br><span class="line">    <span class="comment">// Up to 3 parameters can be indexed.  最多3个indexed参数</span></span><br><span class="line">    <span class="comment">// Indexed parameters helps you filter the logs by the indexed parameter 相当于标识符，索引，可以在日志里过滤出来</span></span><br><span class="line">    event <span class="title class_">Log</span>(address indexed sender, string message);</span><br><span class="line">    event <span class="title class_">AnotherLog</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(msg.<span class="property">sender</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        emit <span class="title class_">Log</span>(msg.<span class="property">sender</span>, <span class="string">&quot;Hello EVM!&quot;</span>);</span><br><span class="line">        emit <span class="title class_">AnotherLog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Constructor:</h1>
<p>A constructor is an optional function that is executed upon contract creation. 合约创建时，构造函数是可选的<br />
Here are examples of how to pass arguments to constructors.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base contract X</span></span><br><span class="line">contract X &#123;</span><br><span class="line">    string public name;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">string memory _name</span>) &#123;</span><br><span class="line">        name = _name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base contract Y</span></span><br><span class="line">contract Y &#123;</span><br><span class="line">    string public text;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">string memory _text</span>) &#123;</span><br><span class="line">        text = _text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// There are 2 ways to initialize parent contract with parameters.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Pass the parameters here in the inheritance list.</span></span><br><span class="line"><span class="comment">// 1.继承列表式</span></span><br><span class="line">contract B is <span class="title function_">X</span>(<span class="string">&quot;Input to X&quot;</span>), <span class="title function_">Y</span>(<span class="params"><span class="string">&quot;Input to Y&quot;</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract C is X, Y &#123;</span><br><span class="line">    <span class="comment">// Pass the parameters here in the constructor,</span></span><br><span class="line">    <span class="comment">// similar to function modifiers.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.类似函数修饰器的写法</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">string memory _name, string memory _text</span>) <span class="title function_">X</span>(_name) <span class="title function_">Y</span>(<span class="params">_text</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parent constructors are always called in the order of inheritance</span></span><br><span class="line"><span class="comment">// regardless of the order of parent contracts listed in the</span></span><br><span class="line"><span class="comment">// constructor of the child contract.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Order of constructors called:</span></span><br><span class="line"><span class="comment">// 1. X</span></span><br><span class="line"><span class="comment">// 2. Y</span></span><br><span class="line"><span class="comment">// 3. D</span></span><br><span class="line">contract D is X, Y &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) <span class="title function_">X</span>(<span class="string">&quot;X was called&quot;</span>) <span class="title function_">Y</span>(<span class="params"><span class="string">&quot;Y was called&quot;</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Order of constructors called:</span></span><br><span class="line"><span class="comment">// 1. X</span></span><br><span class="line"><span class="comment">// 2. Y</span></span><br><span class="line"><span class="comment">// 3. E</span></span><br><span class="line">contract E is X, Y &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) <span class="title function_">Y</span>(<span class="string">&quot;Y was called&quot;</span>) <span class="title function_">X</span>(<span class="params"><span class="string">&quot;X was called&quot;</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 始终按照继承顺序调用父构造函数</span></span><br></pre></td></tr></table></figure>
<h1>Inheritance：</h1>
<p>Solidity supports multiple inheritance. 支持多重继承<br />
Contracts can inherit other contract by using the <code>is</code> keyword.<br />
Function that is going to be overridden by a child contract must be declared as <code>virtual</code>. 父类声明虚函数，可被重写<br />
Function that is going to override a parent function must use the keyword <code>override</code>. 子类声明重载函数</p>
<p>Order of inheritance is important. 继承的顺序很重要<br />
You have to list the parent contracts in the order from “most base-like” to “most derived”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Graph of inheritance</span></span><br><span class="line"><span class="comment">    A</span></span><br><span class="line"><span class="comment">   / \</span></span><br><span class="line"><span class="comment">  B   C</span></span><br><span class="line"><span class="comment"> / \ /</span></span><br><span class="line"><span class="comment">F  D,E</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure virtual returns (string memory) &#123; <span class="comment">// virtual</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Contracts inherit other contracts by using the keyword &#x27;is&#x27;.</span></span><br><span class="line">contract B is A &#123;</span><br><span class="line">    <span class="comment">// Override A.foo()</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure virtual override returns (string memory) &#123; <span class="comment">// virtual override</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract C is A &#123;</span><br><span class="line">    <span class="comment">// Override A.foo()</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure virtual override returns (string memory) &#123; <span class="comment">// virtual override</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;C&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Contracts can inherit from multiple parent contracts.</span></span><br><span class="line"><span class="comment">// When a function is called that is defined multiple times in</span></span><br><span class="line"><span class="comment">// different contracts, parent contracts are searched from</span></span><br><span class="line"><span class="comment">// right to left, and in depth-first manner.</span></span><br><span class="line"><span class="comment">// 当有同名函数时，深度优先，从右到左  😳😳😳</span></span><br><span class="line">contract D is B, C &#123;</span><br><span class="line">    <span class="comment">// D.foo() returns &quot;C&quot;</span></span><br><span class="line">    <span class="comment">// since C is the right most parent contract with function foo()</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure <span class="title function_">override</span>(B, C) returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract E is C, B &#123;</span><br><span class="line">    <span class="comment">// E.foo() returns &quot;B&quot;</span></span><br><span class="line">    <span class="comment">// since B is the right most parent contract with function foo()</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure <span class="title function_">override</span>(C, B) returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Graph of inheritance</span></span><br><span class="line"><span class="comment">    A</span></span><br><span class="line"><span class="comment">   / \</span></span><br><span class="line"><span class="comment">  B   C</span></span><br><span class="line"><span class="comment"> / \ /</span></span><br><span class="line"><span class="comment">F  D,E</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Inheritance must be ordered from “most base-like” to “most derived”.</span></span><br><span class="line"><span class="comment">// Swapping the order of A and B will throw a compilation error.</span></span><br><span class="line"><span class="comment">// 编译报错 TypeError: Linearization of inheritance graph impossible</span></span><br><span class="line"><span class="comment">// 线性继承，声明顺序，类似： 钢笔is 物品,文具    大到小 总分结构</span></span><br><span class="line"><span class="comment">// 同名函数执行顺序，具体到抽象 文具foo()-&gt;物品foo()  小到大 分总结构</span></span><br><span class="line">contract F is A, B &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public pure <span class="title function_">override</span>(A, B) returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Shadowing Inherited State Variables:</h1>
<p>Unlike functions, state variables cannot be overridden by re-declaring it in the child contract.<br />
与函数不同，状态变量不能通过在子合约中重新声明来重写。<br />
Let’s learn how to correctly override inherited state variables.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    string public name = <span class="string">&quot;Contract A&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params"></span>) public view returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Shadowing is disallowed in Solidity 0.6</span></span><br><span class="line"><span class="comment">// This will not compile</span></span><br><span class="line"><span class="comment">// contract B is A &#123;</span></span><br><span class="line"><span class="comment">//     string public name = &quot;Contract B&quot;;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">contract C is A &#123;</span><br><span class="line">    <span class="comment">// This is the correct way to override inherited state variables.</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        name = <span class="string">&quot;Contract C&quot;</span>; <span class="comment">// <span class="doctag">TODO:</span> 只能在构造函数里声明吗？😨😨😨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C.getName returns &quot;Contract C&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Calling Parent Contracts:</h1>
<p>Parent contracts can be called directly, or by using the keyword <code>super</code>.<br />
使用<code>super</code>关键词直接调用父类方法<br />
By using the keyword <code>super</code>, all of the immediate parent contracts will be called.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Inheritance tree</span></span><br><span class="line"><span class="comment">   A</span></span><br><span class="line"><span class="comment"> /  \</span></span><br><span class="line"><span class="comment">B   C</span></span><br><span class="line"><span class="comment"> \ /</span></span><br><span class="line"><span class="comment">  D</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    <span class="comment">// This is called an event. You can emit events from your function</span></span><br><span class="line">    <span class="comment">// and they are logged into the transaction log. </span></span><br><span class="line">    <span class="comment">// In our case, this will be useful for tracing function calls.</span></span><br><span class="line">    <span class="comment">// 事件记录在交易收据里,便于跟踪</span></span><br><span class="line">    event <span class="title class_">Log</span>(string message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public virtual &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;A.foo called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) public virtual &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;A.bar called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B is A &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public virtual override &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;B.foo called&quot;</span>);</span><br><span class="line">        A.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) public virtual override &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;B.bar called&quot;</span>);</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract C is A &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public virtual override &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;C.foo called&quot;</span>);</span><br><span class="line">        A.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) public virtual override &#123;</span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="string">&quot;C.bar called&quot;</span>);</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract D is B, C &#123;</span><br><span class="line">    <span class="comment">// Try:</span></span><br><span class="line">    <span class="comment">// - Call D.foo and check the transaction logs.</span></span><br><span class="line">    <span class="comment">//   Although D inherits A, B and C, it only called C and then A.</span></span><br><span class="line">    <span class="comment">// - Call D.bar and check the transaction logs</span></span><br><span class="line">    <span class="comment">//   D called C, then B, and finally A.</span></span><br><span class="line">    <span class="comment">//   Although super was called twice (by B and C) it only called A once.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) public <span class="title function_">override</span>(<span class="params">B, C</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) public <span class="title function_">override</span>(<span class="params">B, C</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用foo:<br />
<img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713225842.png" alt="20220713225842" /></p>
<p>调用bar:<br />
<img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220713225804.png" alt="20220713225804" /></p>
<h1>Visibility</h1>
<p>Functions and state variables have to declare whether they are accessible by other contracts.<br />
函数和状态变量必须声明它们是否可以被其他合约访问。</p>
<p>Functions can be declared as</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>public</code> - any contract and account can call 当前合约、子合约、外部合约和账户</p>
</li>
<li class="lvl-2">
<p><code>private</code> - only inside the contract that defines the function   当前合约</p>
</li>
<li class="lvl-2">
<p><code>internal</code> - only inside contract that inherits an internal function  当前合约和子合约</p>
</li>
<li class="lvl-2">
<p><code>external</code> - only other contracts and accounts can call  除了当前合约不能访问，子合约、外部合约和账户可以访问</p>
</li>
</ul>
<p>可见性，看不见、访问不到就没法子调用了。</p>
<p>public vs external ???</p>
<p>State variables can be declared as <code>public</code>, <code>private</code>, or <code>internal</code> but not <code>external</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">// Private function can only be called</span></span><br><span class="line">    <span class="comment">// - inside this contract</span></span><br><span class="line">    <span class="comment">// Contracts that inherit this contract cannot call this function.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">privateFunc</span>(<span class="params"></span>) private pure returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;private function called&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testPrivateFunc</span>(<span class="params"></span>) public pure returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">privateFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal function can be called</span></span><br><span class="line">    <span class="comment">// - inside this contract</span></span><br><span class="line">    <span class="comment">// - inside contracts that inherit this contract</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">internalFunc</span>(<span class="params"></span>) internal pure returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;internal function called&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testInternalFunc</span>(<span class="params"></span>) public pure virtual returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">internalFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Public functions can be called</span></span><br><span class="line">    <span class="comment">// - inside this contract</span></span><br><span class="line">    <span class="comment">// - inside contracts that inherit this contract</span></span><br><span class="line">    <span class="comment">// - by other contracts and accounts</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">publicFunc</span>(<span class="params"></span>) public pure returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;public function called&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// External functions can only be called</span></span><br><span class="line">    <span class="comment">// - by other contracts and accounts</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">externalFunc</span>(<span class="params"></span>) external pure returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;external function called&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This function will not compile since we&#x27;re trying to call</span></span><br><span class="line">    <span class="comment">// an external function here.</span></span><br><span class="line">    <span class="comment">// function testExternalFunc() public pure returns (string memory) &#123;</span></span><br><span class="line">    <span class="comment">//     return externalFunc();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State variables</span></span><br><span class="line">    string private privateVar = <span class="string">&quot;my private variable&quot;</span>;</span><br><span class="line">    string internal internalVar = <span class="string">&quot;my internal variable&quot;</span>;</span><br><span class="line">    string public publicVar = <span class="string">&quot;my public variable&quot;</span>;</span><br><span class="line">    <span class="comment">// State variables cannot be external so this code won&#x27;t compile.</span></span><br><span class="line">    <span class="comment">// string external externalVar = &quot;my external variable&quot;;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Child</span> is <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">// Inherited contracts do not have access to private functions</span></span><br><span class="line">    <span class="comment">// and state variables.</span></span><br><span class="line">    <span class="comment">// function testPrivateFunc() public pure returns (string memory) &#123;</span></span><br><span class="line">    <span class="comment">//     return privateFunc();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal function call be called inside child contracts.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testInternalFunc</span>(<span class="params"></span>) public pure override returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">internalFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Interface:</h1>
<p>You can interact with other contracts by declaring an Interface.</p>
<p>Interface</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>cannot have any functions implemented</p>
</li>
<li class="lvl-2">
<p>can inherit from other interfaces</p>
</li>
<li class="lvl-2">
<p>all declared functions must be external</p>
</li>
<li class="lvl-2">
<p>cannot declare a constructor</p>
</li>
<li class="lvl-2">
<p>cannot declare state variables</p>
</li>
</ul>
<p>您可以通过声明一个Interface与其他合约进行交互。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>接口不能有任何实现的函数</p>
</li>
<li class="lvl-2">
<p>可以从其他接口继承</p>
</li>
<li class="lvl-2">
<p>所有声明的函数必须是外部的</p>
</li>
<li class="lvl-2">
<p>不能声明构造函数</p>
</li>
<li class="lvl-2">
<p>不能声明状态变量</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Counter</span> &#123;</span><br><span class="line">    uint public count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) external &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ICounter</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) external view returns (uint);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">MyContract</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">incrementCounter</span>(<span class="params">address _counter</span>) external &#123;</span><br><span class="line">        <span class="title class_">ICounter</span>(_counter).<span class="title function_">increment</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getCount</span>(<span class="params">address _counter</span>) external view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">ICounter</span>(_counter).<span class="title function_">count</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Uniswap example</span></span><br><span class="line">interface <span class="title class_">UniswapV2Factory</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getPair</span>(<span class="params">address tokenA, address tokenB</span>)</span><br><span class="line">        external</span><br><span class="line">        view</span><br><span class="line">        returns (address pair);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">UniswapV2Pair</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getReserves</span>(<span class="params"></span>)</span><br><span class="line">        external</span><br><span class="line">        view</span><br><span class="line">        returns (</span><br><span class="line">            uint112 reserve0,</span><br><span class="line">            uint112 reserve1,</span><br><span class="line">            uint32 blockTimestampLast</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">UniswapExample</span> &#123;</span><br><span class="line">    address private factory = <span class="number">0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f</span>;</span><br><span class="line">    address private dai = <span class="number">0x6B175474E89094C44Da98b954EedeAC495271d0F</span>;</span><br><span class="line">    address private weth = <span class="number">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getTokenReserves</span>(<span class="params"></span>) external view returns (uint, uint) &#123;</span><br><span class="line">        address pair = <span class="title class_">UniswapV2Factory</span>(factory).<span class="title function_">getPair</span>(dai, weth);</span><br><span class="line">        (uint reserve0, uint reserve1, ) = <span class="title class_">UniswapV2Pair</span>(pair).<span class="title function_">getReserves</span>();</span><br><span class="line">        <span class="keyword">return</span> (reserve0, reserve1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Payable:</h1>
<p>Functions and addresses declared <code>payable</code> can receive <code>ether</code> into the contract.<br />
接受ether，不是其他Token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Payable</span> &#123;</span><br><span class="line">    <span class="comment">// Payable address can receive Ether</span></span><br><span class="line">    address payable public owner;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Payable constructor can receive Ether</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) payable &#123;</span><br><span class="line">        owner = <span class="title function_">payable</span>(msg.<span class="property">sender</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to deposit Ether into this contract.</span></span><br><span class="line">    <span class="comment">// Call this function along with some Ether.</span></span><br><span class="line">    <span class="comment">// The balance of this contract will be automatically updated.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">deposit</span>(<span class="params"></span>) public payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call this function along with some Ether.</span></span><br><span class="line">    <span class="comment">// The function will throw an error since this function is not payable.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">notPayable</span>(<span class="params"></span>) public &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to withdraw all Ether from this contract.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="comment">// get the amount of Ether stored in this contract</span></span><br><span class="line">        uint amount = <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// send all Ether to owner</span></span><br><span class="line">        <span class="comment">// Owner can receive Ether since the address of owner is payable</span></span><br><span class="line">        (bool success, ) = owner.<span class="property">call</span>&#123;<span class="attr">value</span>: amount&#125;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(success, <span class="string">&quot;Failed to send Ether&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to transfer Ether from this contract to address from input</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transfer</span>(<span class="params">address payable _to, uint _amount</span>) public &#123;</span><br><span class="line">        <span class="comment">// Note that &quot;to&quot; is declared as payable</span></span><br><span class="line">        (bool success, ) = _to.<span class="property">call</span>&#123;<span class="attr">value</span>: _amount&#125;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(success, <span class="string">&quot;Failed to send Ether&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Sending Ether - Transfer, Send, and Call:</h1>
<h2 id="How-to-send-Ether">How to send Ether?</h2>
<p>You can send Ether to other contracts by</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>transfer</code> (2300 gas, throws error)</p>
</li>
<li class="lvl-2">
<p><code>send</code> (2300 gas, returns bool)</p>
</li>
<li class="lvl-2">
<p><code>call</code> (forward all gas or set gas, returns bool)</p>
</li>
</ul>
<h2 id="How-to-receive-Ether">How to receive Ether?</h2>
<p>A contract receiving Ether must have at least one of the functions below</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>receive() external payable</code></p>
</li>
<li class="lvl-2">
<p><code>fallback() external payable</code></p>
</li>
</ul>
<p>receive() is called if msg.data is empty, otherwise fallback() is called.</p>
<h2 id="Which-method-should-you-use">Which method should you use?</h2>
<p><code>call</code> in combination with re-entrancy guard is the recommended method to use after December 2019.注意防重入</p>
<p>Guard against re-entrancy by</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>making all state changes before calling other contracts 在调用其他合约之前，执行完所有的状态变量更改</p>
</li>
<li class="lvl-2">
<p>using re-entrancy guard modifier</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">ReceiveEther</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Which function is called, fallback() or receive()?</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           send Ether</span></span><br><span class="line"><span class="comment">               |</span></span><br><span class="line"><span class="comment">         msg.data is empty?</span></span><br><span class="line"><span class="comment">              / \</span></span><br><span class="line"><span class="comment">            yes  no</span></span><br><span class="line"><span class="comment">            /     \</span></span><br><span class="line"><span class="comment">receive() exists?  fallback()</span></span><br><span class="line"><span class="comment">         /   \</span></span><br><span class="line"><span class="comment">        yes   no</span></span><br><span class="line"><span class="comment">        /      \</span></span><br><span class="line"><span class="comment">    receive()   fallback()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function to receive Ether. msg.data must be empty</span></span><br><span class="line">    <span class="title function_">receive</span>() external payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fallback function is called when msg.data is not empty</span></span><br><span class="line">    <span class="title function_">fallback</span>() external payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getBalance</span>(<span class="params"></span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">SendEther</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sendViaTransfer</span>(<span class="params">address payable _to</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// This function is no longer recommended for sending Ether.</span></span><br><span class="line">        <span class="comment">// 不推荐</span></span><br><span class="line">        _to.<span class="title function_">transfer</span>(msg.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sendViaSend</span>(<span class="params">address payable _to</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// Send returns a boolean value indicating success or failure.</span></span><br><span class="line">        <span class="comment">// This function is not recommended for sending Ether.</span></span><br><span class="line">        <span class="comment">// 不推荐</span></span><br><span class="line">        bool sent = _to.<span class="title function_">send</span>(msg.<span class="property">value</span>);</span><br><span class="line">        <span class="built_in">require</span>(sent, <span class="string">&quot;Failed to send Ether&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sendViaCall</span>(<span class="params">address payable _to</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// Call returns a boolean value indicating success or failure.</span></span><br><span class="line">        <span class="comment">// This is the current recommended method to use.</span></span><br><span class="line">        <span class="comment">// 推荐</span></span><br><span class="line">        (bool sent, bytes memory data) = _to.<span class="property">call</span>&#123;<span class="attr">value</span>: msg.<span class="property">value</span>&#125;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(sent, <span class="string">&quot;Failed to send Ether&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Fallback:</h1>
<p><code>fallback</code> is a function that does not take any arguments and does not return anything.<br />
一个不接受任何参数且不返回任何内容的函数<br />
It is executed either when 在何时执行</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>a function that does not exist is called or  调用不存在的函数</p>
</li>
<li class="lvl-2">
<p>Ether is sent directly to a contract but <code>receive()</code> does not exist or <code>msg.data</code> is not empty 以太币直接发送到合约但receive()不存在或msg.data不为空</p>
</li>
</ul>
<p><code>fallback</code> has a 2300 gas limit when called by transfer or send.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Fallback</span> &#123;</span><br><span class="line">    event <span class="title class_">Log</span>(uint gas);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fallback function must be declared as external. 回退函数的可见性必须声明为external</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">fallback</span>() external payable &#123;</span><br><span class="line">        <span class="comment">// send / transfer (forwards 2300 gas to this fallback function)</span></span><br><span class="line">        <span class="comment">// call (forwards all of the gas)</span></span><br><span class="line">        emit <span class="title class_">Log</span>(<span class="title function_">gasleft</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Helper function to check the balance of this contract</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getBalance</span>(<span class="params"></span>) public view returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">SendToFallback</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transferToFallback</span>(<span class="params">address payable _to</span>) public payable &#123;</span><br><span class="line">        _to.<span class="title function_">transfer</span>(msg.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">callFallback</span>(<span class="params">address payable _to</span>) public payable &#123;</span><br><span class="line">        (bool sent, ) = _to.<span class="property">call</span>&#123;<span class="attr">value</span>: msg.<span class="property">value</span>&#125;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">require</span>(sent, <span class="string">&quot;Failed to send Ether&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Call:</h1>
<p><code>call</code> is a low level function to interact with other contracts.<br />
This is the recommended method to use when you’re just sending Ether via calling the <code>fallback</code> function.<br />
However it is not the recommend way to call existing functions. 不是调用现有函数的推荐方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    event <span class="title class_">Received</span>(address caller, uint amount, string message);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fallback</span>() external payable &#123;</span><br><span class="line">        emit <span class="title class_">Received</span>(msg.<span class="property">sender</span>, msg.<span class="property">value</span>, <span class="string">&quot;Fallback was called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">string memory _message, uint _x</span>) public payable returns (uint) &#123;</span><br><span class="line">        emit <span class="title class_">Received</span>(msg.<span class="property">sender</span>, msg.<span class="property">value</span>, _message);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _x + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Caller</span> &#123;</span><br><span class="line">    event <span class="title class_">Response</span>(bool success, bytes data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Let&#x27;s imagine that contract B does not have the source code for</span></span><br><span class="line">    <span class="comment">// B合约未开源</span></span><br><span class="line">    <span class="comment">// contract A, but we do know the address of A and the function to call.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testCallFoo</span>(<span class="params">address payable _addr</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// You can send ether and specify a custom gas amount</span></span><br><span class="line">        (bool success, bytes memory data) = _addr.<span class="property">call</span>&#123;<span class="attr">value</span>: msg.<span class="property">value</span>, <span class="attr">gas</span>: <span class="number">5000</span>&#125;(</span><br><span class="line">            abi.<span class="title function_">encodeWithSignature</span>(<span class="string">&quot;foo(string,uint256)&quot;</span>, <span class="string">&quot;call foo&quot;</span>, <span class="number">123</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        emit <span class="title class_">Response</span>(success, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calling a function that does not exist triggers the fallback function.</span></span><br><span class="line">    <span class="comment">// 调用不存在的函数会触发回退函数。</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testCallDoesNotExist</span>(<span class="params">address _addr</span>) public &#123;</span><br><span class="line">        (bool success, bytes memory data) = _addr.<span class="title function_">call</span>(</span><br><span class="line">            abi.<span class="title function_">encodeWithSignature</span>(<span class="string">&quot;doesNotExist()&quot;</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        emit <span class="title class_">Response</span>(success, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Delegatecall:</h1>
<p><code>delegatecall</code> is a low level function similar to <code>call</code>.<br />
When contract <code>A</code> executes <code>delegatecall</code> to contract <code>B</code>, <code>B</code>’s code is excuted<code>with contract</code>A<code>'s storage, </code>msg.sender<code>and</code>msg.value`.</p>
<p>好好理解一下委托的含义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> Deploy this contract first</span></span><br><span class="line">contract B &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> storage layout must be the same as contract A</span></span><br><span class="line">    uint public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint public value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setVars</span>(<span class="params">uint _num</span>) public payable &#123;</span><br><span class="line">        num = _num;</span><br><span class="line">        sender = msg.<span class="property">sender</span>;</span><br><span class="line">        value = msg.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    uint public num;</span><br><span class="line">    address public sender;</span><br><span class="line">    uint public value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setVars</span>(<span class="params">address _contract, uint _num</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// A&#x27;s storage is set, B is not modified.</span></span><br><span class="line">        (bool success, bytes memory data) = _contract.<span class="title function_">delegatecall</span>(</span><br><span class="line">            abi.<span class="title function_">encodeWithSignature</span>(<span class="string">&quot;setVars(uint256)&quot;</span>, _num)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jerrychan807/imggg/master/image/20220714005053.png" alt="20220714005053" /></p>
<h1>Function Selector:</h1>
<p>When a function is called, the first 4 bytes of <code>calldata</code> specifies which function to call.<br />
This 4 bytes is called a function selector.<br />
调用函数时，前 4 个字节calldata指定调用哪个函数。这 4 个字节称为函数选择器。像路由。🤨🤨🤨</p>
<p>Take for example, this code below. It uses <code>call</code> to execute <code>transfer</code> on a contract at the address <code>addr</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addr.<span class="title function_">call</span>(abi.<span class="title function_">encodeWithSignature</span>(<span class="string">&quot;transfer(address,uint256)&quot;</span>, 0xSomeAddress, <span class="number">123</span>))</span><br></pre></td></tr></table></figure>
<p>The first 4 bytes returned from <code>abi.encodeWithSignature(....)</code> is the function selector.<br />
Perhaps you can save a tiny amount of gas if you precompute and inline the function selector in your code?<br />
如果您在代码中预先计算并内联函数选择器，也许您可​​以节省少量gas？<br />
Here is how the function selector is computed.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">FunctionSelector</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &quot;transfer(address,uint256)&quot;</span></span><br><span class="line"><span class="comment">    0xa9059cbb</span></span><br><span class="line"><span class="comment">    &quot;transferFrom(address,address,uint256)&quot;</span></span><br><span class="line"><span class="comment">    0x23b872dd</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getSelector</span>(<span class="params">string calldata _func</span>) external pure returns (bytes4) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">bytes4</span>(<span class="title function_">keccak256</span>(<span class="title function_">bytes</span>(_func)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Calling Other Contract:</h1>
<p>Contract can call other contracts in 2 ways. 可以通过 2 种方式调用其他合约。(不是4种吗?)<br />
The easiest way to is to just call it, like <code>A.foo(x, y, z)</code>.<br />
Another way to call other contracts is to use the low-level <code>call</code>. 不推荐<br />
This method is not recommended.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Callee</span> &#123;</span><br><span class="line">    uint public x;</span><br><span class="line">    uint public value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setX</span>(<span class="params">uint _x</span>) public returns (uint) &#123;</span><br><span class="line">        x = _x;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setXandSendEther</span>(<span class="params">uint _x</span>) public payable returns (uint, uint) &#123;</span><br><span class="line">        x = _x;</span><br><span class="line">        value = msg.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (x, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Caller</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setX</span>(<span class="params">Callee _callee, uint _x</span>) public &#123;</span><br><span class="line">        uint x = _callee.<span class="title function_">setX</span>(_x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setXFromAddress</span>(<span class="params">address _addr, uint _x</span>) public &#123;</span><br><span class="line">        <span class="title class_">Callee</span> callee = <span class="title class_">Callee</span>(_addr);</span><br><span class="line">        callee.<span class="title function_">setX</span>(_x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setXandSendEther</span>(<span class="params">Callee _callee, uint _x</span>) public payable &#123;</span><br><span class="line">        (uint x, uint value) = _callee.<span class="property">setXandSendEther</span>&#123;<span class="attr">value</span>: msg.<span class="property">value</span>&#125;(_x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Creating Contracts from a Contract:</h1>
<p>Contract that Creates other Contracts<br />
Contracts can be created by other contracts using the <code>new</code> keyword. Since 0.8.0, <code>new</code> keyword supports <code>create2</code> feature by specifying <code>salt</code> options.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Car</span> &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    string public model;</span><br><span class="line">    address public carAddr;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address _owner, string memory _model</span>) payable &#123;</span><br><span class="line">        owner = _owner;</span><br><span class="line">        model = _model;</span><br><span class="line">        carAddr = <span class="title function_">address</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">CarFactory</span> &#123;</span><br><span class="line">    <span class="title class_">Car</span>[] public cars;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">address _owner, string memory _model</span>) public &#123;</span><br><span class="line">        <span class="title class_">Car</span> car = <span class="keyword">new</span> <span class="title class_">Car</span>(_owner, _model);</span><br><span class="line">        cars.<span class="title function_">push</span>(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createAndSendEther</span>(<span class="params">address _owner, string memory _model</span>) public payable &#123;</span><br><span class="line">        <span class="title class_">Car</span> car = (<span class="keyword">new</span> <span class="title class_">Car</span>)&#123;<span class="attr">value</span>: msg.<span class="property">value</span>&#125;(_owner, _model);</span><br><span class="line">        cars.<span class="title function_">push</span>(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">create2</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address _owner,</span></span><br><span class="line"><span class="params">        string memory _model,</span></span><br><span class="line"><span class="params">        bytes32 _salt</span></span><br><span class="line"><span class="params">    </span>) public &#123;</span><br><span class="line">        <span class="title class_">Car</span> car = (<span class="keyword">new</span> <span class="title class_">Car</span>)&#123;<span class="attr">salt</span>: _salt&#125;(_owner, _model);</span><br><span class="line">        cars.<span class="title function_">push</span>(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">create2AndSendEther</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address _owner,</span></span><br><span class="line"><span class="params">        string memory _model,</span></span><br><span class="line"><span class="params">        bytes32 _salt</span></span><br><span class="line"><span class="params">    </span>) public payable &#123;</span><br><span class="line">        <span class="title class_">Car</span> car = (<span class="keyword">new</span> <span class="title class_">Car</span>)&#123;<span class="attr">value</span>: msg.<span class="property">value</span>, <span class="attr">salt</span>: _salt&#125;(_owner, _model);</span><br><span class="line">        cars.<span class="title function_">push</span>(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getCar</span>(<span class="params">uint _index</span>)</span><br><span class="line">        public</span><br><span class="line">        view</span><br><span class="line">        returns (</span><br><span class="line">            address owner,</span><br><span class="line">            string memory model,</span><br><span class="line">            address carAddr,</span><br><span class="line">            uint balance</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">Car</span> car = cars[_index];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (car.<span class="title function_">owner</span>(), car.<span class="title function_">model</span>(), car.<span class="title function_">carAddr</span>(), <span class="title function_">address</span>(car).<span class="property">balance</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Try / Catch:</h1>
<p><code>try / catch</code> can only catch errors from external function calls and contract creation. 只能从外部函数调用和合约创建中捕获错误。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// External contract used for try / catch examples</span></span><br><span class="line">contract <span class="title class_">Foo</span> &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address _owner</span>) &#123;</span><br><span class="line">        <span class="built_in">require</span>(_owner != <span class="title function_">address</span>(<span class="number">0</span>), <span class="string">&quot;invalid address&quot;</span>);</span><br><span class="line">        <span class="title function_">assert</span>(_owner != <span class="number">0x0000000000000000000000000000000000000001</span>);</span><br><span class="line">        owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">myFunc</span>(<span class="params">uint x</span>) public pure returns (string memory) &#123;</span><br><span class="line">        <span class="built_in">require</span>(x != <span class="number">0</span>, <span class="string">&quot;require failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;my func was called&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Bar</span> &#123;</span><br><span class="line">    event <span class="title class_">Log</span>(string message);</span><br><span class="line">    event <span class="title class_">LogBytes</span>(bytes data);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Foo</span> public foo;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// This Foo contract is used for example of try catch with external call</span></span><br><span class="line">        foo = <span class="keyword">new</span> <span class="title class_">Foo</span>(msg.<span class="property">sender</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Example of try / catch with external call</span></span><br><span class="line">    <span class="comment">// tryCatchExternalCall(0) =&gt; Log(&quot;external call failed&quot;)</span></span><br><span class="line">    <span class="comment">// tryCatchExternalCall(1) =&gt; Log(&quot;my func was called&quot;)</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tryCatchExternalCall</span>(<span class="params">uint _i</span>) public &#123;</span><br><span class="line">        <span class="keyword">try</span> foo.<span class="title function_">myFunc</span>(_i) returns (string memory result) &#123;</span><br><span class="line">            emit <span class="title class_">Log</span>(result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            emit <span class="title class_">Log</span>(<span class="string">&quot;external call failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Example of try / catch with contract creation</span></span><br><span class="line">    <span class="comment">// tryCatchNewContract(0x0000000000000000000000000000000000000000) =&gt; Log(&quot;invalid address&quot;)</span></span><br><span class="line">    <span class="comment">// tryCatchNewContract(0x0000000000000000000000000000000000000001) =&gt; LogBytes(&quot;&quot;)</span></span><br><span class="line">    <span class="comment">// tryCatchNewContract(0x0000000000000000000000000000000000000002) =&gt; Log(&quot;Foo created&quot;)</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tryCatchNewContract</span>(<span class="params">address _owner</span>) public &#123;</span><br><span class="line">        <span class="keyword">try</span> <span class="keyword">new</span> <span class="title class_">Foo</span>(_owner) returns (<span class="title class_">Foo</span> foo) &#123;</span><br><span class="line">            <span class="comment">// you can use variable foo here</span></span><br><span class="line">            emit <span class="title class_">Log</span>(<span class="string">&quot;Foo created&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="title class_">Error</span>(string memory reason) &#123;</span><br><span class="line">            <span class="comment">// catch failing revert() and require()</span></span><br><span class="line">            emit <span class="title class_">Log</span>(reason);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (bytes memory reason) &#123;</span><br><span class="line">            <span class="comment">// catch failing assert()</span></span><br><span class="line">            emit <span class="title class_">LogBytes</span>(reason);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Import:</h1>
<p>You can import local and external files in Solidity.</p>
<h2 id="Local">Local</h2>
<p>Here is our folder structure.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├── Import.sol</span><br><span class="line">└── Foo.sol</span><br></pre></td></tr></table></figure>
<p>Foo.sol</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">struct <span class="title class_">Point</span> &#123;</span><br><span class="line">    uint x;</span><br><span class="line">    uint y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error <span class="title class_">Unauthorized</span>(address caller);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">uint x, uint y</span>) pure returns (uint) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Foo</span> &#123;</span><br><span class="line">    string public name = <span class="string">&quot;Foo&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Import.sol:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// import Foo.sol from current directory</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./Foo.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// import &#123;symbol1 as alias, symbol2&#125; from &quot;filename&quot;;</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Unauthorized</span>, add <span class="keyword">as</span> func, <span class="title class_">Point</span>&#125; <span class="keyword">from</span> <span class="string">&quot;./Foo.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Import</span> &#123;</span><br><span class="line">    <span class="comment">// Initialize Foo.sol</span></span><br><span class="line">    <span class="title class_">Foo</span> public foo = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test Foo.sol by getting it&#x27;s name.</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getFooName</span>(<span class="params"></span>) public view returns (string memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> foo.<span class="title function_">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="External">External:</h2>
<p>You can also import from GitHub by simply copying the url</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/owner/repo/blob/branch/path/to/Contract.sol</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;https://github.com/owner/repo/blob/branch/path/to/Contract.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example import ECDSA.sol from openzeppelin-contract repo, release-v4.5 branch</span></span><br><span class="line"><span class="comment">// https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/cryptography/ECDSA.sol</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/cryptography/ECDSA.sol&quot;</span>;</span><br></pre></td></tr></table></figure>
<h1>Library:</h1>
<p>Libraries are similar to contracts, but you can’t declare any state variable and you can’t send ether.<br />
A library is embedded into the contract if all library functions are internal.<br />
Otherwise the library must be deployed and then linked before the contract is deployed.</p>
<p>库类似于合约，但你不能声明任何状态变量，也不能发送以太币。如果所有库函数都是内部的，则将库嵌入到合约中。否则，必须先部署库，然后在部署合约之前进行链接。</p>
<p>抽象一层，抽出代码块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">library <span class="title class_">SafeMath</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">uint x, uint y</span>) internal pure returns (uint) &#123;</span><br><span class="line">        uint z = x + y;</span><br><span class="line">        <span class="built_in">require</span>(z &gt;= x, <span class="string">&quot;uint overflow&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">library <span class="title class_">Math</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sqrt</span>(<span class="params">uint y</span>) internal pure returns (uint z) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y &gt; <span class="number">3</span>) &#123;</span><br><span class="line">            z = y;</span><br><span class="line">            uint x = y / <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (x &lt; z) &#123;</span><br><span class="line">                z = x;</span><br><span class="line">                x = (y / x + x) / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y != <span class="number">0</span>) &#123;</span><br><span class="line">            z = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// else z = 0 (default value)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">TestSafeMath</span> &#123;</span><br><span class="line">    using <span class="title class_">SafeMath</span> <span class="keyword">for</span> uint;</span><br><span class="line"></span><br><span class="line">    uint public <span class="variable constant_">MAX_UINT</span> = <span class="number">2</span>**<span class="number">256</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testAdd</span>(<span class="params">uint x, uint y</span>) public pure returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.<span class="title function_">add</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testSquareRoot</span>(<span class="params">uint x</span>) public pure returns (uint) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array function to delete element at index and re-organize the array</span></span><br><span class="line"><span class="comment">// so that their are no gaps between the elements.</span></span><br><span class="line">library <span class="title class_">Array</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">uint[] storage arr, uint index</span>) public &#123;</span><br><span class="line">        <span class="comment">// Move the last element into the place to delete</span></span><br><span class="line">        <span class="built_in">require</span>(arr.<span class="property">length</span> &gt; <span class="number">0</span>, <span class="string">&quot;Can&#x27;t remove from empty array&quot;</span>);</span><br><span class="line">        arr[index] = arr[arr.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">        arr.<span class="title function_">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">TestArray</span> &#123;</span><br><span class="line">    using <span class="title class_">Array</span> <span class="keyword">for</span> uint[];</span><br><span class="line"></span><br><span class="line">    uint[] public arr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">testArrayRemove</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        arr.<span class="title function_">remove</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assert</span>(arr.<span class="property">length</span> == <span class="number">2</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">0</span>] == <span class="number">0</span>);</span><br><span class="line">        <span class="title function_">assert</span>(arr[<span class="number">1</span>] == <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>ABI Decode:</h1>
<p><code>abi.encode</code> encodes data into bytes.<br />
<code>abi.decode</code> decodes bytes back into data.</p>
<p>类似base64编码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">AbiDecode</span> &#123;</span><br><span class="line">    struct <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">        string name;</span><br><span class="line">        uint[<span class="number">2</span>] nums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"></span></span><br><span class="line"><span class="params">        uint x,</span></span><br><span class="line"><span class="params">        address addr,</span></span><br><span class="line"><span class="params">        uint[] calldata arr,</span></span><br><span class="line"><span class="params">        MyStruct calldata myStruct</span></span><br><span class="line"><span class="params">    </span>) external pure returns (bytes memory) &#123;</span><br><span class="line">        <span class="keyword">return</span> abi.<span class="title function_">encode</span>(x, addr, arr, myStruct);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">decode</span>(<span class="params">bytes calldata data</span>)</span><br><span class="line">        external</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            uint x,</span><br><span class="line">            address addr,</span><br><span class="line">            uint[] memory arr,</span><br><span class="line">            <span class="title class_">MyStruct</span> memory myStruct</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// (uint x, address addr, uint[] memory arr, MyStruct myStruct) = ...</span></span><br><span class="line">        (x, addr, arr, myStruct) = abi.<span class="title function_">decode</span>(data, (uint, address, uint[], <span class="title class_">MyStruct</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Hashing with Keccak256:</h1>
<p>keccak256 computes the Keccak-256 hash of the input. 一个哈希算法罢了。</p>
<p>Some use cases are:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Creating a deterministic unique ID from a input 从输入创建确定性唯一ID,例如订单id</p>
</li>
<li class="lvl-2">
<p>Commit-Reveal scheme 应该是提交-验证方案，类似登录密码md5哈希加密</p>
</li>
<li class="lvl-2">
<p>Compact cryptographic signature (by signing the hash instead of a larger input) 紧凑的加密签名（通过签名散列，而不是更大的输入）</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">HashFunction</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">hash</span>(<span class="params"></span></span><br><span class="line"><span class="params">        string memory _text,</span></span><br><span class="line"><span class="params">        uint _num,</span></span><br><span class="line"><span class="params">        address _addr</span></span><br><span class="line"><span class="params">    </span>) public pure returns (bytes32) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(_text, _num, _addr));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Example of hash collision</span></span><br><span class="line">    <span class="comment">// Hash collision can occur when you pass more than one dynamic data type</span></span><br><span class="line">    <span class="comment">// to abi.encodePacked. In such case, you should use abi.encode instead.</span></span><br><span class="line">    <span class="comment">// abi.encodePacked 紧打包可能会有哈希碰撞问题</span></span><br><span class="line">    <span class="comment">// 在这种情况下，建议用abi.encode</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">collision</span>(<span class="params">string memory _text, string memory _anotherText</span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (bytes32)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// encodePacked(AAA, BBB) -&gt; AAABBB</span></span><br><span class="line">        <span class="comment">// encodePacked(AA, ABBB) -&gt; AAABBB</span></span><br><span class="line">        <span class="comment">// Oh,哈希碰撞</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(_text, _anotherText));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">GuessTheMagicWord</span> &#123;</span><br><span class="line">    bytes32 public answer = <span class="number">0x60298f78cc0b47170ba79c10aa3851d7648bd96f2f8e46a19dbc777c36fb0c00</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Magic word is &quot;Solidity&quot;</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">guess</span>(<span class="params">string memory _word</span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(_word)) == answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Verifying Signature:</h1>
<p>Messages can be signed off chain and then verified on chain using a smart contract.<br />
消息可以在链下签名，然后使用智能合约在链上进行验证。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Signature Verification</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">How to Sign and Verify</span></span><br><span class="line"><span class="comment"># Signing</span></span><br><span class="line"><span class="comment">1. Create message to sign</span></span><br><span class="line"><span class="comment">2. Hash the message</span></span><br><span class="line"><span class="comment">3. Sign the hash (off chain, keep your private key secret)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Verify</span></span><br><span class="line"><span class="comment">1. Recreate hash from the original message</span></span><br><span class="line"><span class="comment">2. Recover signer from signature and hash</span></span><br><span class="line"><span class="comment">3. Compare recovered signer to claimed signer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">contract <span class="title class_">VerifySignature</span> &#123;</span><br><span class="line">    <span class="comment">/* 1. Unlock MetaMask account</span></span><br><span class="line"><span class="comment">    ethereum.enable()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 2. Get message hash to sign</span></span><br><span class="line"><span class="comment">    getMessageHash(</span></span><br><span class="line"><span class="comment">        0x14723A09ACff6D2A60DcdF7aA4AFf308FDDC160C,</span></span><br><span class="line"><span class="comment">        123,</span></span><br><span class="line"><span class="comment">        &quot;coffee and donuts&quot;,</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">    )</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    hash = &quot;0xcf36ac4f97dc10d91fc2cbb20d718e94a8cbfe0f82eaedc6a4aa38946fb797cd&quot;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getMessageHash</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address _to,</span></span><br><span class="line"><span class="params">        uint _amount,</span></span><br><span class="line"><span class="params">        string memory _message,</span></span><br><span class="line"><span class="params">        uint _nonce</span></span><br><span class="line"><span class="params">    </span>) public pure returns (bytes32) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">keccak256</span>(abi.<span class="title function_">encodePacked</span>(_to, _amount, _message, _nonce));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 3. Sign message hash</span></span><br><span class="line"><span class="comment">    # using browser</span></span><br><span class="line"><span class="comment">    account = &quot;copy paste account of signer here&quot;</span></span><br><span class="line"><span class="comment">    ethereum.request(&#123; method: &quot;personal_sign&quot;, params: [account, hash]&#125;).then(console.log)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    # using web3</span></span><br><span class="line"><span class="comment">    web3.personal.sign(hash, web3.eth.defaultAccount, console.log)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Signature will be different for different accounts</span></span><br><span class="line"><span class="comment">    0x993dab3dd91f5c6dc28e17439be475478f5635c92a56e17e82349d3fb2f166196f466c0b4e0c146f285204f0dcb13e5ae67bc33f4b888ec32dfe0a063e8f3f781b</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getEthSignedMessageHash</span>(<span class="params">bytes32 _messageHash</span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (bytes32)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Signature is produced by signing a keccak256 hash with the following format:</span></span><br><span class="line"><span class="comment">        &quot;\x19Ethereum Signed Message\n&quot; + len(msg) + msg</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            <span class="title function_">keccak256</span>(</span><br><span class="line">                abi.<span class="title function_">encodePacked</span>(<span class="string">&quot;\x19Ethereum Signed Message:\n32&quot;</span>, _messageHash)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 4. Verify signature</span></span><br><span class="line"><span class="comment">    signer = 0xB273216C05A8c0D4F0a4Dd0d7Bae1D2EfFE636dd</span></span><br><span class="line"><span class="comment">    to = 0x14723A09ACff6D2A60DcdF7aA4AFf308FDDC160C</span></span><br><span class="line"><span class="comment">    amount = 123</span></span><br><span class="line"><span class="comment">    message = &quot;coffee and donuts&quot;</span></span><br><span class="line"><span class="comment">    nonce = 1</span></span><br><span class="line"><span class="comment">    signature =</span></span><br><span class="line"><span class="comment">        0x993dab3dd91f5c6dc28e17439be475478f5635c92a56e17e82349d3fb2f166196f466c0b4e0c146f285204f0dcb13e5ae67bc33f4b888ec32dfe0a063e8f3f781b</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">verify</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address _signer,</span></span><br><span class="line"><span class="params">        address _to,</span></span><br><span class="line"><span class="params">        uint _amount,</span></span><br><span class="line"><span class="params">        string memory _message,</span></span><br><span class="line"><span class="params">        uint _nonce,</span></span><br><span class="line"><span class="params">        bytes memory signature</span></span><br><span class="line"><span class="params">    </span>) public pure returns (bool) &#123;</span><br><span class="line">        bytes32 messageHash = <span class="title function_">getMessageHash</span>(_to, _amount, _message, _nonce);</span><br><span class="line">        bytes32 ethSignedMessageHash = <span class="title function_">getEthSignedMessageHash</span>(messageHash);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">recoverSigner</span>(ethSignedMessageHash, signature) == _signer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">recoverSigner</span>(<span class="params">bytes32 _ethSignedMessageHash, bytes memory _signature</span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (address)</span><br><span class="line">    &#123;</span><br><span class="line">        (bytes32 r, bytes32 s, uint8 v) = <span class="title function_">splitSignature</span>(_signature);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">ecrecover</span>(_ethSignedMessageHash, v, r, s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">splitSignature</span>(<span class="params">bytes memory sig</span>)</span><br><span class="line">        public</span><br><span class="line">        pure</span><br><span class="line">        returns (</span><br><span class="line">            bytes32 r,</span><br><span class="line">            bytes32 s,</span><br><span class="line">            uint8 v</span><br><span class="line">        )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">require</span>(sig.<span class="property">length</span> == <span class="number">65</span>, <span class="string">&quot;invalid signature length&quot;</span>);</span><br><span class="line"></span><br><span class="line">        assembly &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            First 32 bytes stores the length of the signature</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            add(sig, 32) = pointer of sig + 32</span></span><br><span class="line"><span class="comment">            effectively, skips first 32 bytes of signature</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            mload(p) loads next 32 bytes starting at the memory address p into memory</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// first 32 bytes, after the length prefix</span></span><br><span class="line">            r := <span class="title function_">mload</span>(<span class="title function_">add</span>(sig, <span class="number">32</span>))</span><br><span class="line">            <span class="comment">// second 32 bytes</span></span><br><span class="line">            s := <span class="title function_">mload</span>(<span class="title function_">add</span>(sig, <span class="number">64</span>))</span><br><span class="line">            <span class="comment">// final byte (first byte of the next 32 bytes)</span></span><br><span class="line">            v := <span class="title function_">byte</span>(<span class="number">0</span>, <span class="title function_">mload</span>(<span class="title function_">add</span>(sig, <span class="number">96</span>)))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// implicitly return (r, s, v)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/59484.html" rel="bookmark">Doc-币安智能链WhitePaper</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/57835.html" rel="bookmark">DevRecord-TradingView技术分析指标API</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/43604.html" rel="bookmark">OpenZeppelin-ERC20-extensions源码学习(一)</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/23566.html" rel="bookmark">OpenZeppelin-代码库QuickView</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/24654.html" rel="bookmark">Project-CoolErc20-blacklist-具备黑名单代币</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SmartContract/" rel="tag"># SmartContract</a>
              <a href="/tags/Document/" rel="tag"># Document</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/56133.html" rel="prev" title="Crypto-pancakeSwap收税地址的简单分析">
      <i class="fa fa-chevron-left"></i> Crypto-pancakeSwap收税地址的简单分析
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/18978.html" rel="next" title="StudyRecord-Solidity异常处理">
      StudyRecord-Solidity异常处理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
<script src="https://utteranc.es/client.js"
        repo="jerrychan807/blog-comment"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

    

      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">Pre:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">Hello World:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">3.</span> <span class="nav-text">First App:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">4.</span> <span class="nav-text">Primitive Data Types:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">5.</span> <span class="nav-text">Variables</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">6.</span> <span class="nav-text">Constants</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">7.</span> <span class="nav-text">Immutable</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">8.</span> <span class="nav-text">Reading and Writing to a State Variable</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">9.</span> <span class="nav-text">Ether and Wei</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">10.</span> <span class="nav-text">Gas and Gas Price：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gas-Limit"><span class="nav-number">10.1.</span> <span class="nav-text">Gas Limit</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">11.</span> <span class="nav-text">If &#x2F; Else:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">12.</span> <span class="nav-text">For and While Loop:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">13.</span> <span class="nav-text">Mapping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">14.</span> <span class="nav-text">Array：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Remove-array-element-by-shifting-elements-from-right-to-left"><span class="nav-number">14.1.</span> <span class="nav-text">Remove array element by shifting elements from right to left</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Remove-array-element-by-copying-last-element-into-to-the-place-to-remove"><span class="nav-number">14.2.</span> <span class="nav-text">Remove array element by copying last element into to the place to remove</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">15.</span> <span class="nav-text">Enum:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%88%E7%BA%A6%E5%A4%96%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="nav-number">15.1.</span> <span class="nav-text">合约外定义：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">16.</span> <span class="nav-text">Structs:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5struct%EF%BC%9A"><span class="nav-number">16.1.</span> <span class="nav-text">导入struct：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">17.</span> <span class="nav-text">Data Locations - Storage, Memory and Calldata:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">18.</span> <span class="nav-text">Function:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">19.</span> <span class="nav-text">View and Pure Functions:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">20.</span> <span class="nav-text">Error:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">21.</span> <span class="nav-text">Function Modifier:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">22.</span> <span class="nav-text">Events:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">23.</span> <span class="nav-text">Constructor:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">24.</span> <span class="nav-text">Inheritance：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">25.</span> <span class="nav-text">Shadowing Inherited State Variables:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">26.</span> <span class="nav-text">Calling Parent Contracts:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">27.</span> <span class="nav-text">Visibility</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">28.</span> <span class="nav-text">Interface:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">29.</span> <span class="nav-text">Payable:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">30.</span> <span class="nav-text">Sending Ether - Transfer, Send, and Call:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-send-Ether"><span class="nav-number">30.1.</span> <span class="nav-text">How to send Ether?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-receive-Ether"><span class="nav-number">30.2.</span> <span class="nav-text">How to receive Ether?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Which-method-should-you-use"><span class="nav-number">30.3.</span> <span class="nav-text">Which method should you use?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">31.</span> <span class="nav-text">Fallback:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">32.</span> <span class="nav-text">Call:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">33.</span> <span class="nav-text">Delegatecall:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">34.</span> <span class="nav-text">Function Selector:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">35.</span> <span class="nav-text">Calling Other Contract:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">36.</span> <span class="nav-text">Creating Contracts from a Contract:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">37.</span> <span class="nav-text">Try &#x2F; Catch:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">38.</span> <span class="nav-text">Import:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Local"><span class="nav-number">38.1.</span> <span class="nav-text">Local</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External"><span class="nav-number">38.2.</span> <span class="nav-text">External:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">39.</span> <span class="nav-text">Library:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">40.</span> <span class="nav-text">ABI Decode:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">41.</span> <span class="nav-text">Hashing with Keccak256:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">42.</span> <span class="nav-text">Verifying Signature:</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Foolisheddy"
      src="https://i.loli.net/2019/04/26/5cc1da1c90e1a.png">
  <p class="site-author-name" itemprop="name">Foolisheddy</p>
  <div class="site-description" itemprop="description">温故而知新</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">143</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jerrychan807" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jerrychan807" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:529883409@qq.com" title="E-Mail → mailto:529883409@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Foolisheddy</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">873k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">13:14</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
